<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title></title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: white;
      font-family: "Noto Serif SC", serif;
      font-size: 18px;
      overflow-y: auto;
      height: auto;
      min-height: 100vh;
      position: relative;
    }

    #canvas {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 80px auto;
      padding: 0 20px 120px;
      box-sizing: border-box;
      min-height: 100vh;
      z-index: 2;
    }

    .char-wrapper {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 32px;
      opacity: 0;
    }

    .char {
      font-size: 18px;
      color: black;
      z-index: 2;
    }

    .circle {
      position: absolute;
      width: 28px;
      height: 28px;
      border: 1px solid rgba(0, 0, 0, 0.4);
      border-radius: 50%;
      z-index: 1;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      opacity: 0.5;
      animation: popout 2.5s ease-out forwards;
      pointer-events: none;
    }

    @keyframes popout {
      0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0.5;
      }
      100% {
        transform: translate(-50%, -50%) scale(2.5);
        opacity: 0;
      }
    }

    .snowflake {
      position: fixed;
      top: -10px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.1);
      pointer-events: none;
      z-index: 1;
    }

    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      opacity: 0;
      pointer-events: none;
      z-index: 3;
      transition: opacity 60s linear;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    #final-text {
      color: white;
      font-size: 20px;
      text-align: center;
      white-space: pre-wrap;
      opacity: 0;
      transition: opacity 3s ease-in;
    }
  </style>
</head>
<body>
  <div id="overlay">
    <div id="final-text">（唔，可我把矫情坏了）
万物守恒，从我的角度来说你并不喜欢我，
所以我们分手吧。</div>
  </div>
  <div id="canvas"></div>

  <script>
    const poem = `你的爱太远了，
像枝头迟迟不肯开的花。
我等了又等，
等到春天都凉了半截。

我原以为爱是靠近，
后来才知道，
它也可以是一种安静自耗的等待。

我们不是此消彼长，
只是供需不对等。
我给得太多，
你却始终没有准备好要。

我不怪你，
只是久了，
心真的倦了。

我来时是真心的。
可一段关系，靠一个人走不成。

你给得太少，太迟，太模糊。
我够不到，也不想再够了。

也许你从来没有拒绝我，
但你也从未真正向我走来。

我站在原地太久了。
风吹了好几季，
我才明白——你不会来了。

……

现在我也爱你，可是——
倦了，倦了；
倦了，倦了；
我们分开吧。`;

    const container = document.getElementById("canvas");
    const lines = poem.split('\n');

    const charWidth = 28;
    const lineHeight = 34;
    const baseX = 20;
    const baseY = 0;

    const allChars = [];

    lines.forEach((line, row) => {
      [...line].forEach((char, col) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'char-wrapper';

        const charSpan = document.createElement('span');
        charSpan.className = 'char';
        charSpan.textContent = char;

        wrapper.appendChild(charSpan);
        container.appendChild(wrapper);

        const startX = -60 + Math.random() * 120;
        const startY = -100 + Math.random() * 80;
        wrapper.style.left = `${startX}px`;
        wrapper.style.top = `${startY}px`;

        const finalX = baseX + col * charWidth;
        const finalY = baseY + row * lineHeight;

        allChars.push({
          el: wrapper,
          targetX: finalX,
          targetY: finalY,
        });
      });
    });

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    shuffle(allChars);

    allChars.forEach((item, i) => {
      const { el, targetX, targetY } = item;
      const delay = i * 40 + Math.random() * 80;

      setTimeout(() => {
        el.style.transition = 'all 800ms ease-out';
        el.style.left = `${targetX}px`;
        el.style.top = `${targetY}px`;
        el.style.opacity = 1;

        const circle = document.createElement('div');
        circle.className = 'circle';
        el.appendChild(circle);

        setTimeout(() => {
          circle.remove();
        }, 3000);
      }, delay);
    });

    function createSnowflake() {
      const flake = document.createElement('div');
      flake.className = 'snowflake';
      flake.style.left = `${Math.random() * window.innerWidth}px`;
      document.body.appendChild(flake);

      let top = -10;
      const speed = 1 + Math.random() * 2;
      const drift = (Math.random() - 0.5) * 2;

      function fall() {
        top += speed;
        flake.style.top = `${top}px`;
        flake.style.left = `${parseFloat(flake.style.left) + drift}px`;
        if (top < window.innerHeight) {
          requestAnimationFrame(fall);
        }
      }
      fall();
    }

    setInterval(() => {
      for (let i = 0; i < 15; i++) createSnowflake();
    }, 80);

    setTimeout(() => {
      const overlay = document.getElementById('overlay');
      overlay.style.opacity = 1;
      setTimeout(() => {
        const text = document.getElementById('final-text');
        text.style.opacity = 1;
      }, 61000);
    }, 100);
  </script>
</body>
</html>
